# Deploy to Render

## Current Database

- **Local Development:** SQLite (skillgap.db)
- **Production (Render):** PostgreSQL (automatically switches via DATABASE_URL)

## Deployment Steps

### 1. Prerequisites

- GitHub repository pushed with latest code ✅
- Render account (sign up at https://render.com)
- API keys ready (Google, Gemini, Groq, OpenAI)

### 2. Deploy Using Blueprint (Automated)

#### Option A: Deploy via Dashboard

1. Go to https://render.com/dashboard
2. Click **"New" → "Blueprint"**
3. Connect your GitHub repository: `praveenr0211/AiSkillGapAnalyzer`
4. Render will detect `render.yaml` and set up:
   - PostgreSQL Database
   - Backend API Service
   - Frontend Static Site

#### Option B: Deploy via CLI

```bash
# Install Render CLI (if not already installed)
npm install -g render-cli

# Login to Render
render login

# Deploy from repository
render blueprint launch
```

### 3. Configure Environment Variables

After deployment, add these environment variables in Render Dashboard:

**Backend Service → Environment:**

- `GOOGLE_CLIENT_ID` - Your Google OAuth Client ID
- `GOOGLE_CLIENT_SECRET` - Your Google OAuth Client Secret
- `GOOGLE_GEMINI_API_KEY` - Your Gemini API key
- `GROQ_API_KEY` - Your Groq API key
- `OPENAI_API_KEY` - Your OpenAI API key
- `SESSION_SECRET` - Auto-generated by Render
- `DATABASE_URL` - Auto-connected from PostgreSQL
- `CLIENT_URL` - Update to your frontend URL

**Frontend Service → Environment:**

- `REACT_APP_API_URL` - Update to your backend URL

### 4. Initialize Database Tables

After backend is deployed, run initialization:

```bash
# SSH into your backend service
render ssh skillgap-analyzer-backend

# Run database initialization
cd backend
node initDatabase.js
node initAdminTable.js
node initCoursesTable.js
node initChatTable.js
node initHistoryTable.js
node initProgressTable.js
```

Or use the combined script:

```bash
# Windows
init-all-tables.bat

# Linux/Mac
chmod +x init-all-tables.sh
./init-all-tables.sh
```

### 5. Update Google OAuth Redirect URIs

Add these to Google Cloud Console:

- `https://skillgap-analyzer-backend.onrender.com/auth/google/callback`
- `https://your-custom-domain.com/auth/google/callback` (if using custom domain)

### 6. Verify Deployment

- **Backend Health Check:** `https://skillgap-analyzer-backend.onrender.com/api/health`
- **Frontend:** `https://skillgap-analyzer-frontend.onrender.com`

## Manual Deployment (Alternative)

### Backend Service

1. Dashboard → New → Web Service
2. Connect repository
3. Settings:
   - **Name:** skillgap-analyzer-backend
   - **Root Directory:** (leave empty)
   - **Build Command:** `cd backend && npm install`
   - **Start Command:** `cd backend && node server.js`
   - **Environment:** Node

### Frontend Service

1. Dashboard → New → Static Site
2. Connect repository
3. Settings:
   - **Name:** skillgap-analyzer-frontend
   - **Root Directory:** (leave empty)
   - **Build Command:** `cd frontend && npm install && npm run build`
   - **Publish Directory:** `frontend/build`

### Database

1. Dashboard → New → PostgreSQL
2. Settings:
   - **Name:** skillgap-db
   - **Database:** skillgap_analyzer
   - **User:** skillgap_user
3. Copy connection string to backend's `DATABASE_URL`

## Post-Deployment

### Monitor Logs

```bash
# Backend logs
render logs skillgap-analyzer-backend --tail

# Database logs
render logs skillgap-db --tail
```

### Database Backups

Render automatically backs up PostgreSQL databases daily.

### Custom Domain (Optional)

1. Go to service settings → Custom Domains
2. Add your domain
3. Update DNS records as shown

## Troubleshooting

### Database Connection Issues

- Check `DATABASE_URL` is set correctly
- Verify database service is running
- Check PostgreSQL connection string format

### Build Failures

- Check Node.js version compatibility
- Verify all dependencies in package.json
- Review build logs in Render Dashboard

### CORS Issues

- Update `CLIENT_URL` in backend env vars
- Check CORS settings in backend/server.js

## Cost Estimate

- **Free Tier:**

  - PostgreSQL: 90 days free, then $7/month
  - Web Services: Free tier available (spins down after inactivity)
  - Static Sites: Free

- **Paid Plans:** Starting at $7/month per service

## Next Steps

1. ✅ Push code to GitHub
2. ⏳ Create Render account
3. ⏳ Deploy via Blueprint
4. ⏳ Configure environment variables
5. ⏳ Initialize database
6. ⏳ Test application
